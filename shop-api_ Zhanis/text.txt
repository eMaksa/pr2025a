header('Content-Type: application/json')

Эта строчка говорит браузеру или клиенту, что сервер отдаёт данные в формате JSON. Без неё браузер может неправильно понять данные или их будет неудобно читать.

 SQL-инъекция и защита

SQL-инъекция — это когда кто-то может вставить вредоносный код в параметры (например, в URL) и получить или изменить данные в базе.
Использование Prepared Statements безопасно: данные и код разделены, поэтому никакой вредоносный код выполнен не будет.

Как из плоского JOIN сделать JSON

JOIN возвращает “плоскую” таблицу — каждая строка = заказ + один товар.
В PHP мы создали массив items, куда положили все товары этого заказа, а общую информацию о заказе и клиенте вынесли наверх.
В результате JSON получается структурированным: сверху данные о заказе и клиенте, а товары — в списке items.